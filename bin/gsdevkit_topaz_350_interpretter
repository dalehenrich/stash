#!/usr/bin/env bash
#
#	command line interpretter for topaz script
#	
#	using 3.5.0 and beyond topaz commands
#

topazFile=`realpath $1`
shift

debug="false"
if [ "$1" = "-D" ] ; then
	# hack .. for now
	debug="true"
	shift
fi

topazArgs="$*"
if [ $# -eq 0 ] ; then
	topazArgs="$GEMSTONE_SCRIPT_ARGS"
fi

file=`mktemp`
logFile=`mktemp`

echo "log file: $logFile"

cat - > $file << EOF
	output push $logFile only
	set INPUTPAUSEONERROR on
	input $topazFile
	output pop
	obj1 **
	EXITIFNOERROR
EOF

if [ "$debug" = "true" ] ; then
		echo "INPUT $file"
		$GS_HOME/bin/startTopaz $topazArgs
	else
		$GS_HOME/bin/startTopaz $topazArgs << EOF
		input $file
EOF
	status="$?"
	if [ "$status" != 0 ] ; then
		cat $logFile
		exit $status
	fi
fi
